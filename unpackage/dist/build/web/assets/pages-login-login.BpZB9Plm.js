import{s as a,a as e,t as s,h as l,b as o,r as t,c as r,w as n,i,o as d,d as u,e as c,f,I as m,g}from"./index-C85BGToL.js";import{s as p,a as h}from"./auth.yulpUJA0.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=_({data:()=>({form:{username:"",password:""},logging:!1}),onShow(){this.form.username="",this.form.password=""},methods:{async handleLogin(){if(!this.logging){if(!this.form.username||!this.form.password)return a({title:"请输入账号和密码",icon:"none"});this.logging=!0,e({title:"登录中…"});try{const e=(await s.callFunction({name:"crm-auth",data:{action:"login",data:{username:this.form.username,password:this.form.password}}})).result||{};if(0!==e.code)return l(),this.logging=!1,a({title:e.msg||"账号或密码错误",icon:"none"});p(e.token),h(e.user),o("crm_user",e.user),a({title:"登录成功",icon:"success"}),setTimeout((()=>{t({url:"/pages/dashboard/index"})}),300)}catch(r){console.error("登录异常",r),a({title:"登录失败，请检查网络或云函数",icon:"none"})}finally{l(),this.logging=!1}}}}},[["render",function(a,e,s,l,o,t){const p=i,h=f,_=m,w=g;return d(),r(p,{class:"login-page"},{default:n((()=>[u(p,{class:"bg-glow glow-1"}),u(p,{class:"bg-glow glow-2"}),u(p,{class:"login-inner"},{default:n((()=>[u(p,{class:"hero"},{default:n((()=>[u(p,{class:"hero-logo"},{default:n((()=>[u(h,{class:"hero-logo-text"},{default:n((()=>[c("气")])),_:1})])),_:1}),u(p,{class:"hero-text"},{default:n((()=>[u(h,{class:"hero-title"},{default:n((()=>[c("新拓能源")])),_:1}),u(h,{class:"hero-sub"},{default:n((()=>[c("送气与对账助手")])),_:1})])),_:1})])),_:1}),u(p,{class:"login-card"},{default:n((()=>[u(p,{class:"form-item"},{default:n((()=>[u(h,{class:"form-label"},{default:n((()=>[c("账号")])),_:1}),u(p,{class:"input-wrapper"},{default:n((()=>[u(_,{class:"form-input",modelValue:o.form.username,"onUpdate:modelValue":e[0]||(e[0]=a=>o.form.username=a),type:"text",placeholder:"请输入账号",maxlength:"50",autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1}),u(p,{class:"form-item"},{default:n((()=>[u(h,{class:"form-label"},{default:n((()=>[c("密码")])),_:1}),u(p,{class:"input-wrapper"},{default:n((()=>[u(_,{class:"form-input",modelValue:o.form.password,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.password=a),type:"password",placeholder:"请输入密码",maxlength:"50",autocomplete:"new-password"},null,8,["modelValue"])])),_:1})])),_:1}),u(w,{class:"login-btn",onClick:t.handleLogin,disabled:o.logging},{default:n((()=>[u(p,{class:"login-btn-inner"},{default:n((()=>[o.logging?(d(),r(h,{key:1},{default:n((()=>[c("登录中…")])),_:1})):(d(),r(h,{key:0},{default:n((()=>[c("登录")])),_:1}))])),_:1})])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-4791b12e"]]);export{w as default};
