import{j as t,s as e,r as a,t as s,n as l,k as i,a as n,h as o,q as r,c as d,w as c,i as u,o as f,d as m,e as g,p as _,l as h,u as p,v as k,F as v,f as y,g as x,I as w,x as C,m as b}from"./index-C85BGToL.js";import{B as T}from"./BackToDashboardBar.BBeceW6P.js";import{g as I}from"./auth.yulpUJA0.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=L({components:{BackToDashboardBar:T},data:()=>({loading:!1,rawList:[],keyword:"",statusOptions:["全部状态","在职","请假","离职"],statusIndex:0,isAdmin:!1,userInfo:{}}),computed:{statusLabel(){return this.statusOptions[this.statusIndex]},filteredList(){const t=(this.keyword||"").trim(),e=0===this.statusIndex?"":this.statusOptions[this.statusIndex];return this.rawList.filter((a=>{const s=this.formatStatusText(a.status);if(e&&s!==e)return!1;if(!t)return!0;const l=a.name||"",i=a.phone||"";return-1!==l.indexOf(t)||-1!==i.indexOf(t)}))}},onLoad(){this.initRole()},onShow(){this.initRole(),this.loadList()},methods:{initRole(){const t=I()||{};this.userInfo=t,this.isAdmin="admin"===t.role},formatStatusText(t){const e=(t||"").trim();return"在职"===e||"active"===e?"在职":"请假"===e||"on_leave"===e?"请假":"离职"===e||"leave"===e?"离职":e||"在职"},statusTagClass(t){const e=this.formatStatusText(t);return"在职"===e?"status-tag--active":"请假"===e?"status-tag--leave":"离职"===e?"status-tag--inactive":"status-tag--active"},statusDotClass(t){const e=this.formatStatusText(t);return"在职"===e?"status-dot--active":"请假"===e?"status-dot--leave":"离职"===e?"status-dot--inactive":"status-dot--active"},getToken:()=>t("crm_token")||t("token")||"",async loadList(){const t=this.getToken();if(!t)return e({title:"请先登录",icon:"none"}),void setTimeout((()=>{a({url:"/pages/login/login"})}),1200);this.loading=!0;try{const l=(await s.callFunction({name:"crm-delivery",data:{action:"list",token:t,data:{}}})).result||{};if(401===l.code)return e({title:l.msg||"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{a({url:"/pages/login/login"})}),1200);if(0!==l.code)return void e({title:l.msg||"加载失败",icon:"none"});this.rawList=l.data||[]}catch(l){console.error("crm-delivery list error:",l),e({title:"加载失败，请稍后再试",icon:"none"})}finally{this.loading=!1}},onStatusChange(t){this.statusIndex=Number(t.detail.value||0)},onSearch(){},resetFilter(){this.keyword="",this.statusIndex=0},goCreate(){if(!this.isAdmin)return e({title:"当前账号无权限新增配送员",icon:"none"});l({url:"/pages/delivery/edit"})},goEdit(t){if(!this.isAdmin)return e({title:"当前账号无权限编辑配送员",icon:"none"});l({url:`/pages/delivery/edit?id=${t._id}`})},confirmRemove(t){if(!this.isAdmin)return e({title:"当前账号无权限删除配送员",icon:"none"});i({title:"删除确认",content:`确定要删除配送员「${t.name||""}」吗？`,confirmColor:"#e11d48",success:e=>{e.confirm&&this.removeItem(t)}})},async removeItem(t){if(!this.isAdmin)return e({title:"当前账号无权限删除配送员",icon:"none"});const l=this.getToken();if(!l)return e({title:"请先登录",icon:"none"}),void setTimeout((()=>{a({url:"/pages/login/login"})}),1200);try{n({title:"删除中…",mask:!0});const i=(await s.callFunction({name:"crm-delivery",data:{action:"remove",token:l,data:{id:t._id}}})).result||{};if(401===i.code)return e({title:i.msg||"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{a({url:"/pages/login/login"})}),1200);0!==i.code?e({title:i.msg||"删除失败",icon:"none"}):(e({title:"已删除",icon:"success"}),this.loadList())}catch(i){console.error("crm-delivery remove error",i),e({title:"删除失败，请稍后重试",icon:"none"})}finally{o()}}}},[["render",function(t,e,a,s,l,i){const n=r("BackToDashboardBar"),o=y,T=u,I=x,L=w,S=C;return f(),d(T,{class:"page"},{default:c((()=>[m(T,{class:"inner"},{default:c((()=>[m(n,{"back-to":"/pages/dashboard/index",text:"返回工作台"}),m(T,{class:"page-header"},{default:c((()=>[m(T,{class:"page-header-left"},{default:c((()=>[m(T,{class:"page-icon"},{default:c((()=>[m(o,{class:"page-icon-text"},{default:c((()=>[g("配")])),_:1})])),_:1}),m(T,{class:"page-header-text"},{default:c((()=>[m(o,{class:"page-title"},{default:c((()=>[g("配送员管理")])),_:1}),m(o,{class:"page-sub"},{default:c((()=>[g("维护配送员信息，方便派单与对账")])),_:1})])),_:1})])),_:1}),m(T,{class:"page-header-right"},{default:c((()=>[l.isAdmin?(f(),d(I,{key:0,class:"btn-primary",onClick:i.goCreate},{default:c((()=>[g(" + 新增配送员 ")])),_:1},8,["onClick"])):_("",!0)])),_:1})])),_:1}),m(T,{class:"card card-filter"},{default:c((()=>[m(T,{class:"filter-row"},{default:c((()=>[m(T,{class:"filter-item keyword"},{default:c((()=>[m(o,{class:"label"},{default:c((()=>[g("关键词")])),_:1}),m(T,{class:"input-wrapper"},{default:c((()=>[m(L,{class:"input",modelValue:l.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>l.keyword=t),placeholder:"按姓名 / 手机号搜索","confirm-type":"search",onConfirm:i.onSearch},null,8,["modelValue","onConfirm"])])),_:1})])),_:1}),m(T,{class:"filter-item status"},{default:c((()=>[m(o,{class:"label"},{default:c((()=>[g("状态")])),_:1}),m(S,{mode:"selector",range:l.statusOptions,value:l.statusIndex,onChange:i.onStatusChange},{default:c((()=>[m(T,{class:"input-wrapper picker-wrapper"},{default:c((()=>[m(T,{class:"picker"},{default:c((()=>[m(o,null,{default:c((()=>[g(h(i.statusLabel),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["range","value","onChange"])])),_:1}),m(T,{class:"filter-item btns"},{default:c((()=>[m(I,{class:"btn-soft",onClick:i.resetFilter},{default:c((()=>[g("重置")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),m(T,{class:"card"},{default:c((()=>[m(T,{class:"card-header"},{default:c((()=>[m(o,{class:"card-title"},{default:c((()=>[g("配送员列表")])),_:1}),m(o,{class:"card-sub"},{default:c((()=>[g("共 "+h(i.filteredList.length)+" 人",1)])),_:1})])),_:1}),l.loading?(f(),d(T,{key:0,class:"list-loading"},{default:c((()=>[m(o,{class:"loading-text"},{default:c((()=>[g("加载中…")])),_:1})])),_:1})):(f(),d(T,{key:1},{default:c((()=>[0===i.filteredList.length?(f(),d(T,{key:0,class:"empty"},{default:c((()=>[m(o,{class:"empty-main"},{default:c((()=>[g("暂无数据")])),_:1}),l.isAdmin?(f(),d(o,{key:0,class:"empty-sub"},{default:c((()=>[g(" 可以点击右上角「新增配送员」进行添加 ")])),_:1})):(f(),d(o,{key:1,class:"empty-sub"},{default:c((()=>[g(" 当前账号仅能查看配送员信息，如需维护配送员，请联系管理员 ")])),_:1}))])),_:1})):(f(),d(T,{key:1,class:"list"},{default:c((()=>[(f(!0),p(v,null,k(i.filteredList,(t=>(f(),d(T,{key:t._id,class:"row"},{default:c((()=>[m(T,{class:"row-main"},{default:c((()=>[m(T,{class:"avatar"},{default:c((()=>[m(o,{class:"avatar-text"},{default:c((()=>[g(h((t.name||"配").slice(0,1).toUpperCase()),1)])),_:2},1024)])),_:2},1024),m(T,{class:"row-text"},{default:c((()=>[m(T,{class:"row-title-line"},{default:c((()=>[m(o,{class:"row-name"},{default:c((()=>[g(h(t.name||"-"),1)])),_:2},1024),m(T,{class:b(["status-tag",i.statusTagClass(t.status)])},{default:c((()=>[m(o,{class:b(["status-dot",i.statusDotClass(t.status)])},null,8,["class"]),m(o,{class:"status-text"},{default:c((()=>[g(h(i.formatStatusText(t.status)),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),m(T,{class:"row-meta"},{default:c((()=>[t.phone?(f(),d(o,{key:0,class:"meta-item"},{default:c((()=>[g(" 手机："+h(t.phone),1)])),_:2},1024)):_("",!0),t.remark?(f(),d(o,{key:1,class:"meta-item meta-remark"},{default:c((()=>[g(" 备注："+h(t.remark),1)])),_:2},1024)):_("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),l.isAdmin?(f(),d(T,{key:0,class:"row-actions"},{default:c((()=>[m(I,{class:"btn-link",onClick:e=>i.goEdit(t)},{default:c((()=>[g("编辑")])),_:2},1032,["onClick"]),m(I,{class:"btn-link danger",onClick:e=>i.confirmRemove(t)},{default:c((()=>[g("删除")])),_:2},1032,["onClick"])])),_:2},1024)):_("",!0)])),_:2},1024)))),128))])),_:1}))])),_:1}))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-50d4200c"]]);export{S as default};
