import{s as t,t as e,n as a,l as s,a as l,h as i,v as n,c as o,w as r,i as d,o as c,d as u,e as f,q as m,f as _,x as h,y as p,F as g,g as k,j as y,I as v,z as x,p as w}from"./index-B6DdPhlT.js";import{B as C}from"./BackToDashboardBar.0jhbkRhX.js";import{_ as b,e as L,g as I,i as T,f as S}from"./_plugin-vue_export-helper.Dda_PF8M.js";const A=b({components:{BackToDashboardBar:C},data:()=>({loading:!1,rawList:[],keyword:"",statusOptions:["全部状态","在职","请假","离职"],statusIndex:0,isAdmin:!1,userInfo:{}}),computed:{statusLabel(){return this.statusOptions[this.statusIndex]},filteredList(){const t=(this.keyword||"").trim(),e=0===this.statusIndex?"":this.statusOptions[this.statusIndex];return this.rawList.filter((a=>{const s=this.formatStatusText(a.status);if(e&&s!==e)return!1;if(!t)return!0;const l=a.name||"",i=a.phone||"";return-1!==l.indexOf(t)||-1!==i.indexOf(t)}))}},onLoad(){L()&&(this.initRole(),this.loadList())},onShow(){L()&&(this.initRole(),this.loadList())},methods:{initRole(){const t=I()||{};this.userInfo=t,this.isAdmin=T(t)},formatStatusText(t){const e=(t||"").trim();return"在职"===e||"active"===e?"在职":"请假"===e||"on_leave"===e?"请假":"离职"===e||"leave"===e?"离职":e||"在职"},statusTagClass(t){const e=this.formatStatusText(t);return"在职"===e?"status-tag--active":"请假"===e?"status-tag--leave":"离职"===e?"status-tag--inactive":"status-tag--active"},statusDotClass(t){const e=this.formatStatusText(t);return"在职"===e?"status-dot--active":"请假"===e?"status-dot--leave":"离职"===e?"status-dot--inactive":"status-dot--active"},getToken(){const e=S();return e||(t({title:"登录已过期，请重新登录",icon:"none"}),L(),"")},async loadList(){const a=this.getToken();if(a){this.loading=!0;try{const s=(await e.callFunction({name:"crm-delivery",data:{action:"list",token:a,data:{}}})).result||{};if(401===s.code)return t({title:s.msg||"登录已过期，请重新登录",icon:"none"}),void L();if(0!==s.code)return void t({title:s.msg||"加载失败",icon:"none"});this.rawList=s.data||[]}catch(s){console.error("crm-delivery list error:",s),t({title:"加载失败，请稍后再试",icon:"none"})}finally{this.loading=!1}}},onStatusChange(t){this.statusIndex=Number(t.detail.value||0)},onSearch(){},resetFilter(){this.keyword="",this.statusIndex=0},goCreate(){if(!this.isAdmin)return t({title:"当前账号无权限新增配送员",icon:"none"});a({url:"/pages/delivery/edit"})},goEdit(e){if(!this.isAdmin)return t({title:"当前账号无权限编辑配送员",icon:"none"});a({url:`/pages/delivery/edit?id=${e._id}`})},confirmRemove(e){if(!this.isAdmin)return t({title:"当前账号无权限删除配送员",icon:"none"});s({title:"删除确认",content:`确定要删除配送员「${e.name||""}」吗？`,confirmColor:"#e11d48",success:t=>{t.confirm&&this.removeItem(e)}})},async removeItem(a){if(!this.isAdmin)return t({title:"当前账号无权限删除配送员",icon:"none"});const s=this.getToken();if(s)try{l({title:"删除中…",mask:!0});const n=(await e.callFunction({name:"crm-delivery",data:{action:"remove",token:s,data:{id:a._id}}})).result||{};if(401===n.code)return t({title:n.msg||"登录已过期，请重新登录",icon:"none"}),void L();0!==n.code?t({title:n.msg||"删除失败",icon:"none"}):(t({title:"已删除",icon:"success"}),this.loadList())}catch(n){console.error("crm-delivery remove error",n),t({title:"删除失败，请稍后重试",icon:"none"})}finally{i()}}}},[["render",function(t,e,a,s,l,i){const C=n("BackToDashboardBar"),b=k,L=d,I=y,T=v,S=x;return c(),o(L,{class:"page"},{default:r((()=>[u(L,{class:"inner"},{default:r((()=>[u(C,{"back-to":"/pages/dashboard/index",text:"返回工作台"}),u(L,{class:"page-header"},{default:r((()=>[u(L,{class:"page-header-left"},{default:r((()=>[u(L,{class:"page-icon"},{default:r((()=>[u(b,{class:"page-icon-text"},{default:r((()=>[f("配")])),_:1})])),_:1}),u(L,{class:"page-header-text"},{default:r((()=>[u(b,{class:"page-title"},{default:r((()=>[f("配送员管理")])),_:1}),u(b,{class:"page-sub"},{default:r((()=>[f("维护配送员信息，方便派单与对账")])),_:1})])),_:1})])),_:1}),u(L,{class:"page-header-right"},{default:r((()=>[l.isAdmin?(c(),o(I,{key:0,class:"btn-primary",onClick:i.goCreate},{default:r((()=>[f(" + 新增配送员 ")])),_:1},8,["onClick"])):m("",!0)])),_:1})])),_:1}),u(L,{class:"card card-filter"},{default:r((()=>[u(L,{class:"filter-row"},{default:r((()=>[u(L,{class:"filter-item keyword"},{default:r((()=>[u(b,{class:"label"},{default:r((()=>[f("关键词")])),_:1}),u(L,{class:"input-wrapper"},{default:r((()=>[u(T,{class:"input",modelValue:l.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>l.keyword=t),placeholder:"按姓名 / 手机号搜索","confirm-type":"search",onConfirm:i.onSearch},null,8,["modelValue","onConfirm"])])),_:1})])),_:1}),u(L,{class:"filter-item status"},{default:r((()=>[u(b,{class:"label"},{default:r((()=>[f("状态")])),_:1}),u(S,{mode:"selector",range:l.statusOptions,value:l.statusIndex,onChange:i.onStatusChange},{default:r((()=>[u(L,{class:"input-wrapper picker-wrapper"},{default:r((()=>[u(L,{class:"picker"},{default:r((()=>[u(b,null,{default:r((()=>[f(_(i.statusLabel),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["range","value","onChange"])])),_:1}),u(L,{class:"filter-item btns"},{default:r((()=>[u(I,{class:"btn-soft",onClick:i.resetFilter},{default:r((()=>[f("重置")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),u(L,{class:"card"},{default:r((()=>[u(L,{class:"card-header"},{default:r((()=>[u(b,{class:"card-title"},{default:r((()=>[f("配送员列表")])),_:1}),u(b,{class:"card-sub"},{default:r((()=>[f("共 "+_(i.filteredList.length)+" 人",1)])),_:1})])),_:1}),l.loading?(c(),o(L,{key:0,class:"list-loading"},{default:r((()=>[u(b,{class:"loading-text"},{default:r((()=>[f("加载中…")])),_:1})])),_:1})):(c(),o(L,{key:1},{default:r((()=>[0===i.filteredList.length?(c(),o(L,{key:0,class:"empty"},{default:r((()=>[u(b,{class:"empty-main"},{default:r((()=>[f("暂无数据")])),_:1}),l.isAdmin?(c(),o(b,{key:0,class:"empty-sub"},{default:r((()=>[f(" 可以点击右上角「新增配送员」进行添加 ")])),_:1})):(c(),o(b,{key:1,class:"empty-sub"},{default:r((()=>[f(" 当前账号仅能查看配送员信息，如需维护配送员，请联系管理员 ")])),_:1}))])),_:1})):(c(),o(L,{key:1,class:"list"},{default:r((()=>[(c(!0),h(g,null,p(i.filteredList,(t=>(c(),o(L,{key:t._id,class:"row"},{default:r((()=>[u(L,{class:"row-main"},{default:r((()=>[u(L,{class:"avatar"},{default:r((()=>[u(b,{class:"avatar-text"},{default:r((()=>[f(_((t.name||"配").slice(0,1).toUpperCase()),1)])),_:2},1024)])),_:2},1024),u(L,{class:"row-text"},{default:r((()=>[u(L,{class:"row-title-line"},{default:r((()=>[u(b,{class:"row-name"},{default:r((()=>[f(_(t.name||"-"),1)])),_:2},1024),u(L,{class:w(["status-tag",i.statusTagClass(t.status)])},{default:r((()=>[u(b,{class:w(["status-dot",i.statusDotClass(t.status)])},null,8,["class"]),u(b,{class:"status-text"},{default:r((()=>[f(_(i.formatStatusText(t.status)),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),u(L,{class:"row-meta"},{default:r((()=>[t.phone?(c(),o(b,{key:0,class:"meta-item"},{default:r((()=>[f(" 手机："+_(t.phone),1)])),_:2},1024)):m("",!0),t.remark?(c(),o(b,{key:1,class:"meta-item meta-remark"},{default:r((()=>[f(" 备注："+_(t.remark),1)])),_:2},1024)):m("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),l.isAdmin?(c(),o(L,{key:0,class:"row-actions"},{default:r((()=>[u(I,{class:"btn-link",onClick:e=>i.goEdit(t)},{default:r((()=>[f("编辑")])),_:2},1032,["onClick"]),u(I,{class:"btn-link danger",onClick:e=>i.confirmRemove(t)},{default:r((()=>[f("删除")])),_:2},1032,["onClick"])])),_:2},1024)):m("",!0)])),_:2},1024)))),128))])),_:1}))])),_:1}))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-7fdbf0ab"]]);export{A as default};
