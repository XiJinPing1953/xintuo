import{s,a as e,t as o,h as a,b as l,r as t,c as r,w as i,i as n,o as d,d as m,e as u,f as c,g as f,I as g,j as h}from"./index-B6DdPhlT.js";import{_ as p,s as w,a as _}from"./_plugin-vue_export-helper.Dda_PF8M.js";const x=p({data:()=>({form:{username:"",password:""},logging:!1,showPassword:!1}),onShow(){this.form.username="",this.form.password="",this.showPassword=!1},methods:{togglePassword(){this.showPassword=!this.showPassword},validateForm(){const e=(this.form.username||"").trim(),o=(this.form.password||"").trim();return e&&o?e.length<3?(s({title:"账号长度至少 3 位",icon:"none"}),!1):!(o.length<6)||(s({title:"密码长度至少 6 位",icon:"none"}),!1):(s({title:"请输入账号和密码",icon:"none"}),!1)},async handleLogin(){if(!this.logging&&this.validateForm()){this.logging=!0,e({title:"登录中…"});try{const e=(await o.callFunction({name:"crm-auth",data:{action:"login",data:{username:this.form.username,password:this.form.password}}})).result||{};if(0!==e.code)return a(),this.logging=!1,s({title:e.msg||"账号或密码错误",icon:"none"});w(e.token,{expireAt:e.expire_at||e.expireAt,expireIn:e.expire_in||e.expireIn}),_(e.user),l("crm_user",e.user),s({title:"登录成功",icon:"success"}),setTimeout((()=>{t({url:"/pages/dashboard/index"})}),300)}catch(r){console.error("登录异常",r),s({title:"登录失败，请检查网络或云函数",icon:"none"})}finally{a(),this.logging=!1}}}},computed:{isFormValid(){const s=(this.form.username||"").trim(),e=(this.form.password||"").trim();return s.length>=3&&e.length>=6}}},[["render",function(s,e,o,a,l,t){const p=n,w=f,_=g,x=h;return d(),r(p,{class:"login-page"},{default:i((()=>[m(p,{class:"bg-glow glow-1"}),m(p,{class:"bg-glow glow-2"}),m(p,{class:"login-inner"},{default:i((()=>[m(p,{class:"hero"},{default:i((()=>[m(p,{class:"hero-logo"},{default:i((()=>[m(w,{class:"hero-logo-text"},{default:i((()=>[u("气")])),_:1})])),_:1}),m(p,{class:"hero-text"},{default:i((()=>[m(w,{class:"hero-title"},{default:i((()=>[u("新拓能源")])),_:1}),m(w,{class:"hero-sub"},{default:i((()=>[u("送气与对账助手")])),_:1})])),_:1})])),_:1}),m(p,{class:"login-card"},{default:i((()=>[m(p,{class:"form-item"},{default:i((()=>[m(w,{class:"form-label"},{default:i((()=>[u("账号")])),_:1}),m(p,{class:"input-wrapper"},{default:i((()=>[m(_,{class:"form-input",modelValue:l.form.username,"onUpdate:modelValue":e[0]||(e[0]=s=>l.form.username=s),modelModifiers:{trim:!0},type:"text",placeholder:"请输入账号",maxlength:"50",autocomplete:"off",onConfirm:t.handleLogin},null,8,["modelValue","onConfirm"])])),_:1})])),_:1}),m(p,{class:"form-item"},{default:i((()=>[m(w,{class:"form-label"},{default:i((()=>[u("密码")])),_:1}),m(p,{class:"input-wrapper"},{default:i((()=>[m(_,{class:"form-input",type:l.showPassword?"text":"password",modelValue:l.form.password,"onUpdate:modelValue":e[1]||(e[1]=s=>l.form.password=s),modelModifiers:{trim:!0},placeholder:"请输入密码",maxlength:"50",autocomplete:"new-password",onConfirm:t.handleLogin},null,8,["type","modelValue","onConfirm"]),m(p,{class:"suffix",onClick:t.togglePassword},{default:i((()=>[m(w,{class:"suffix-text"},{default:i((()=>[u(c(l.showPassword?"隐藏":"显示"),1)])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),m(x,{class:"login-btn",onClick:t.handleLogin,disabled:l.logging||!t.isFormValid},{default:i((()=>[m(p,{class:"login-btn-inner"},{default:i((()=>[l.logging?(d(),r(w,{key:1},{default:i((()=>[u("登录中…")])),_:1})):(d(),r(w,{key:0},{default:i((()=>[u(c(t.isFormValid?"登录":"请完成信息"),1)])),_:1}))])),_:1})])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-06ecc607"]]);export{x as default};
