import{k as n,b as t,L as o,C as e,s as r,r as c}from"./index-B6DdPhlT.js";let s=!1;function a(){try{return n("crm_token")||n("token")||""}catch(t){return""}}function u(n,o={}){if(!n)return;const{expireAt:e,expireIn:r}=o,c=Date.now(),s=e||(r?c+r:c+6048e5);console.log("[auth/setToken] 保存 token，并记录有效期到",new Date(s)),t("crm_token",n),t("crm_token_meta",{createdAt:c,expiresAt:s})}function i(){console.log("[auth/clearAuth] 清空登录信息");try{o("crm_token"),o("crm_user_info"),o("crm_token_meta")}catch(n){}}function l(n){console.log("[auth/setUserInfo] 保存用户信息"),t("crm_user_info",n||{})}function g(){try{return n("crm_user_info")||{}}catch(t){return{}}}function f(n){const t=n&&n.role;return!t||("admin"===t||"superadmin"===t)}function m(n){return"superadmin"===(n&&n.role)}function _(){try{return n("crm_token_meta")||{}}catch(t){return{}}}function h(n){if(!n)return!1;const{expiresAt:t,createdAt:o}=n,e=Date.now();return!!(t&&e>t)||!!(!t&&o&&e-o>6048e5)}function k(n){var t;if(s)console.log("[auth/goLogin] 已在跳转中，忽略");else{try{const n=e(),o=(null==(t=n[n.length-1])?void 0:t.route)||"";if(console.log("[auth/goLogin] 当前路由 =",o),"pages/login/login"===o)return void console.log("[auth/goLogin] 已在登录页，直接返回")}catch(o){}s=!0,n&&r({title:n,icon:"none",duration:1500}),i(),setTimeout((()=>{console.log("[auth/goLogin] reLaunch 到登录页"),c({url:"/pages/login/login"}),setTimeout((()=>{s=!1}),500)}),n?1200:0)}}function p(){const n=a(),t=_();return n?!h(t)||(console.log("[auth/ensureLogin] token 已过期，触发重新登录"),i(),k("登录已过期，请重新登录"),!1):(k("请先登录"),!1)}const d=(n,t)=>{const o=n.__vccOpts||n;for(const[e,r]of t)o[e]=r;return o};export{d as _,l as a,m as b,i as c,k as d,p as e,a as f,g,_ as h,f as i,h as j,u as s};
