import{j as t,s as e,r as a,a as s,t as l,h as i,B as o,C as n,q as r,c as d,w as u,i as c,o as m,d as f,e as h,l as p,f as g,I as b,x as _,D as v,g as k}from"./index-C85BGToL.js";import{B as y}from"./BackToDashboardBar.BBeceW6P.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=x({components:{BackToDashboardBar:y},data:()=>({id:"",form:{name:"",mobile:"",status:"active",remark:""},submitting:!1,statusOptions:[{label:"在职",value:"active"},{label:"请假/停工",value:"leave"},{label:"离职",value:"inactive"}],statusIndex:0}),computed:{isEdit(){return!!this.id},statusLabel(){return this.statusOptions[this.statusIndex].label}},onLoad(t){this.id=t&&t.id?t.id:"",this.id&&this.loadDetail()},methods:{getToken:()=>t("crm_token")||t("token")||"",onStatusChange(t){const e=Number(t.detail.value||0);this.statusIndex=e,this.form.status=this.statusOptions[e].value},async loadDetail(){const t=this.getToken();if(!t)return e({title:"请先登录",icon:"none"}),void setTimeout((()=>{a({url:"/pages/login/login"})}),1200);try{s({title:"加载中…",mask:!0});const o=(await l.callFunction({name:"crm-delivery",data:{action:"get",token:t,data:{id:this.id}}})).result||{};if(401===o.code)return e({title:o.msg||"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{a({url:"/pages/login/login"})}),1200);if(0!==o.code||!o.data)return void e({title:o.msg||"加载失败",icon:"none"});const n=o.data;this.form.name=n.name||"",this.form.mobile=n.mobile||"",this.form.status=n.status||"active",this.form.remark=n.remark||"";const r=this.statusOptions.findIndex((t=>t.value===this.form.status));this.statusIndex=r>=0?r:0}catch(o){console.error("load delivery detail error:",o),e({title:"加载失败，请稍后再试",icon:"none"})}finally{i()}},async handleSubmit(){if(this.submitting)return;if(!this.form.name.trim())return e({title:"请填写姓名",icon:"none"});const t=this.getToken();if(!t)return e({title:"请先登录",icon:"none"}),void setTimeout((()=>{a({url:"/pages/login/login"})}),1200);const o={name:this.form.name.trim(),mobile:this.form.mobile.trim(),status:this.form.status,remark:this.form.remark.trim()};this.submitting=!0;try{s({title:this.isEdit?"保存中…":"创建中…",mask:!0});const n=(await l.callFunction({name:"crm-delivery",data:{action:this.isEdit?"update":"create",token:t,data:this.isEdit?{id:this.id,...o}:o}})).result||{};if(401===n.code)return e({title:n.msg||"登录已过期，请重新登录",icon:"none"}),void setTimeout((()=>{a({url:"/pages/login/login"})}),1200);if(0!==n.code)return void e({title:n.msg||"保存失败",icon:"none"});e({title:this.isEdit?"保存成功":"创建成功",icon:"success"}),setTimeout((()=>{this.goBack(!0)}),400)}catch(n){console.error("save delivery error:",n),e({title:"保存失败，请稍后再试",icon:"none"})}finally{this.submitting=!1,i()}},goBack(t){o().length>1?n():a({url:"/pages/delivery/list"})}}},[["render",function(t,e,a,s,l,i){const o=r("BackToDashboardBar"),n=g,y=c,x=b,T=_,B=v,V=k;return m(),d(y,{class:"page"},{default:u((()=>[f(y,{class:"inner"},{default:u((()=>[f(o,{"back-to":"/pages/delivery/list",text:"返回"}),f(y,{class:"page-header"},{default:u((()=>[f(y,{class:"page-header-left"},{default:u((()=>[f(y,{class:"page-icon"},{default:u((()=>[f(n,{class:"page-icon-text"},{default:u((()=>[h("配")])),_:1})])),_:1}),f(y,{class:"page-header-text"},{default:u((()=>[f(n,{class:"page-title"},{default:u((()=>[h(p(i.isEdit?"编辑配送员":"新增配送员"),1)])),_:1}),f(n,{class:"page-sub"},{default:u((()=>[h(" 维护配送员姓名、联系方式与状态信息 ")])),_:1})])),_:1})])),_:1})])),_:1}),f(y,{class:"card"},{default:u((()=>[f(y,{class:"card-header"},{default:u((()=>[f(n,{class:"card-title"},{default:u((()=>[h("基本信息")])),_:1})])),_:1}),f(y,{class:"card-body"},{default:u((()=>[f(y,{class:"form-item"},{default:u((()=>[f(n,{class:"label"},{default:u((()=>[h("* 姓名")])),_:1}),f(y,{class:"input-wrapper"},{default:u((()=>[f(x,{class:"input",modelValue:l.form.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.form.name=t),placeholder:"请输入配送员姓名"},null,8,["modelValue"])])),_:1})])),_:1}),f(y,{class:"form-item"},{default:u((()=>[f(n,{class:"label"},{default:u((()=>[h("手机号")])),_:1}),f(y,{class:"input-wrapper"},{default:u((()=>[f(x,{class:"input",modelValue:l.form.mobile,"onUpdate:modelValue":e[1]||(e[1]=t=>l.form.mobile=t),type:"number",placeholder:"可填写手机号或联系电话"},null,8,["modelValue"])])),_:1})])),_:1}),f(y,{class:"form-item"},{default:u((()=>[f(n,{class:"label"},{default:u((()=>[h("状态")])),_:1}),f(T,{mode:"selector",range:l.statusOptions,"range-key":"label",value:l.statusIndex,onChange:i.onStatusChange},{default:u((()=>[f(y,{class:"input-wrapper"},{default:u((()=>[f(y,{class:"picker"},{default:u((()=>[f(n,null,{default:u((()=>[h(p(i.statusLabel),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["range","value","onChange"])])),_:1}),f(y,{class:"form-item"},{default:u((()=>[f(n,{class:"label"},{default:u((()=>[h("备注")])),_:1}),f(B,{class:"textarea",modelValue:l.form.remark,"onUpdate:modelValue":e[2]||(e[2]=t=>l.form.remark=t),placeholder:"例如：主负责城北片区、熟悉XX路段"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),f(y,{class:"btn-row-bottom"},{default:u((()=>[f(V,{class:"btn-primary",loading:l.submitting,onClick:i.handleSubmit},{default:u((()=>[h(p(i.isEdit?"保存修改":"保存配送员"),1)])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-a7f1a5c0"]]);export{T as default};
