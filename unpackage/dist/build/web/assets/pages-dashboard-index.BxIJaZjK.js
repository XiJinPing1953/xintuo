import{j as a,t,s,n as e,k as l,c,w as i,i as d,o,d as n,e as u,l as r,m as f,p as _,f as g}from"./index-C85BGToL.js";import{e as b,g as m,c as h,b as p}from"./auth.yulpUJA0.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=x({data:()=>({userInfo:{},activeMenu:"dashboard",stats:{today_weight:0,today_amount:0,month_amount:0,month_unpaid:0,gas_stock:0}}),computed:{isAdmin(){const a=this.userInfo&&this.userInfo.role;return!a||"admin"===a}},onLoad(){b()&&(this.userInfo=m()||{},this.activeMenu="dashboard",this.fetchStats())},methods:{async fetchStats(){const s=a("crm_token")||a("token")||"";if(s)try{const a=(await t.callFunction({name:"crm-dashboard",data:{action:"summary",token:s}})).result||{};0===a.code&&a.data?this.stats=Object.assign({},this.stats,a.data):console.warn("fetchStats error:",a.msg)}catch(e){console.error("fetchStats exception:",e)}},formatNumber(a,t=2){const s=Number(a);return Number.isNaN(s)?0:s.toFixed(t)},formatKgToTon(a,t=3){const s=Number(a);return Number.isNaN(s)?0:(s/1e3).toFixed(t)},formatDate(a){const t=a instanceof Date?a:new Date(a);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},getTodayRange(){const a=new Date,t=this.formatDate(a);return{start:t,end:t}},getMonthRange(){const a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1);return{start:this.formatDate(t),end:this.formatDate(a),month:`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`}},goPage(a,t){t&&(this.activeMenu=t),a&&"/pages/dashboard/index"!==a&&(!a.startsWith("/pages/sale/edit")||this.isAdmin?e({url:a}):s({title:"当前账号无权限新增销售记录",icon:"none"}))},handleLogout(){l({title:"退出登录",content:"确定要退出当前账号吗？",success:a=>{a.confirm&&(h(),p())}})},handleStatClick(a){switch(a){case"gas_stock":{const{start:a,end:t}=this.getMonthRange();this.goPage(`/pages/gas/inbound?date_from=${a}&date_to=${t}`,"gas-in");break}case"today_weight":{const{start:a,end:t}=this.getTodayRange();this.goPage(`/pages/sale/list?date_from=${a}&date_to=${t}`,"sale-list");break}case"today_amount":{const{start:a,end:t}=this.getTodayRange();this.goPage(`/pages/sale/list?date_from=${a}&date_to=${t}`,"sale-list");break}case"month_amount":case"month_unpaid":{const{start:a,end:t,month:s}=this.getMonthRange();this.goPage(`/pages/bill/monthly?month=${s}&date_from=${a}&date_to=${t}`,"bill");break}}}}},[["render",function(a,t,s,e,l,b){const m=g,h=d;return o(),c(h,{class:"dashboard-page"},{default:i((()=>[n(h,{class:"dashboard-inner"},{default:i((()=>[n(h,{class:"top-hero"},{default:i((()=>[n(h,{class:"hero-left"},{default:i((()=>[n(h,{class:"hero-logo"},{default:i((()=>[n(m,{class:"hero-logo-icon"},{default:i((()=>[u("logo")])),_:1})])),_:1}),n(h,{class:"hero-text"},{default:i((()=>[n(h,{class:"hero-title"},{default:i((()=>[u("新拓能源")])),_:1})])),_:1})])),_:1}),n(h,{class:"hero-right"},{default:i((()=>[n(h,{class:"hero-user-tag"},{default:i((()=>[n(h,{class:"hero-avatar"},{default:i((()=>[n(m,{class:"hero-avatar-text"},{default:i((()=>[u(r((l.userInfo.username||"admin").slice(0,1).toUpperCase()),1)])),_:1})])),_:1}),n(h,{class:"hero-user-text"},{default:i((()=>[n(m,{class:"hero-user-role"},{default:i((()=>[u(r(b.isAdmin?"管理员":"普通员工"),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),n(h,{class:"layout-main"},{default:i((()=>[n(h,{class:"sidebar"},{default:i((()=>[n(h,{class:"sidebar-section"},{default:i((()=>[n(h,{class:"sidebar-section-title"},{default:i((()=>[u("日常操作")])),_:1}),b.isAdmin?(o(),c(h,{key:0,class:f(["sidebar-item",{active:"sale"===l.activeMenu}]),onClick:t[0]||(t[0]=a=>b.goPage("/pages/sale/edit","sale"))},{default:i((()=>[n(h,{class:"sidebar-badge sidebar-badge-primary"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("记")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("新增销售记录")])),_:1})])),_:1},8,["class"])):_("",!0),n(h,{class:f(["sidebar-item",{active:"sale-list"===l.activeMenu}]),onClick:t[1]||(t[1]=a=>b.goPage("/pages/sale/list","sale-list"))},{default:i((()=>[n(h,{class:"sidebar-badge"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("销")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("销售记录列表")])),_:1})])),_:1},8,["class"]),n(h,{class:f(["sidebar-item",{active:"bill"===l.activeMenu}]),onClick:t[2]||(t[2]=a=>b.goPage("/pages/bill/monthly","bill"))},{default:i((()=>[n(h,{class:"sidebar-badge"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("账")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("对账单")])),_:1})])),_:1},8,["class"]),n(h,{class:f(["sidebar-item",{active:"filling"===l.activeMenu}]),onClick:t[3]||(t[3]=a=>b.goPage("/pages/filling/index","filling"))},{default:i((()=>[n(h,{class:"sidebar-badge sidebar-badge-accent"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("灌")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("灌装管理")])),_:1})])),_:1},8,["class"]),n(h,{class:f(["sidebar-item",{active:"gas-in"===l.activeMenu}]),onClick:t[4]||(t[4]=a=>b.goPage("/pages/gas/inbound","gas-in"))},{default:i((()=>[n(h,{class:"sidebar-badge"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("气")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("天然气入库")])),_:1})])),_:1},8,["class"])])),_:1}),n(h,{class:"sidebar-section"},{default:i((()=>[n(h,{class:"sidebar-section-title"},{default:i((()=>[u("基础资料")])),_:1}),n(h,{class:f(["sidebar-item",{active:"customer"===l.activeMenu}]),onClick:t[5]||(t[5]=a=>b.goPage("/pages/customer/list","customer"))},{default:i((()=>[n(h,{class:"sidebar-badge"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("客")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("客户管理")])),_:1})])),_:1},8,["class"]),n(h,{class:f(["sidebar-item",{active:"vehicle"===l.activeMenu}]),onClick:t[6]||(t[6]=a=>b.goPage("/pages/vehicle/list","vehicle"))},{default:i((()=>[n(h,{class:"sidebar-badge"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("车")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("车辆管理")])),_:1})])),_:1},8,["class"]),n(h,{class:f(["sidebar-item",{active:"delivery"===l.activeMenu}]),onClick:t[7]||(t[7]=a=>b.goPage("/pages/delivery/list","delivery"))},{default:i((()=>[n(h,{class:"sidebar-badge"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("配")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("配送员管理")])),_:1})])),_:1},8,["class"]),n(h,{class:f(["sidebar-item",{active:"bottle"===l.activeMenu}]),onClick:t[8]||(t[8]=a=>b.goPage("/pages/bottle/manage","bottle"))},{default:i((()=>[n(h,{class:"sidebar-badge"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("瓶")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("瓶子管理")])),_:1})])),_:1},8,["class"])])),_:1}),n(h,{class:"sidebar-footer"},{default:i((()=>[n(h,{class:"sidebar-divider"}),n(h,{class:"sidebar-item danger",onClick:b.handleLogout},{default:i((()=>[n(h,{class:"sidebar-badge sidebar-badge-danger"},{default:i((()=>[n(m,{class:"sidebar-badge-text"},{default:i((()=>[u("退")])),_:1})])),_:1}),n(m,{class:"sidebar-text"},{default:i((()=>[u("退出登录")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),n(h,{class:"main-content"},{default:i((()=>[n(h,{class:"card card-stats"},{default:i((()=>[n(h,{class:"card-header"},{default:i((()=>[n(h,{class:"card-title"},{default:i((()=>[u("今日概览")])),_:1}),n(h,{class:"card-sub"},{default:i((()=>[u("出气量、销售额、未收款与天然气库存")])),_:1})])),_:1}),n(h,{class:"stats-row"},{default:i((()=>[n(h,{class:"stat-card",onClick:t[9]||(t[9]=a=>b.handleStatClick("gas_stock"))},{default:i((()=>[n(h,{class:"stat-icon-box blue"},{default:i((()=>[n(m,{class:"stat-icon"},{default:i((()=>[u("存")])),_:1})])),_:1}),n(h,{class:"stat-body"},{default:i((()=>[n(m,{class:"stat-label"},{default:i((()=>[u("当前天然气库存")])),_:1}),n(h,{class:"stat-value-row"},{default:i((()=>[n(m,{class:"stat-value"},{default:i((()=>[u(r(b.formatKgToTon(l.stats.gas_stock)),1)])),_:1}),n(m,{class:"stat-unit"},{default:i((()=>[u("吨")])),_:1})])),_:1}),n(m,{class:"stat-tip"},{default:i((()=>[u("按入库净重减去销售净重自动估算")])),_:1})])),_:1})])),_:1}),n(h,{class:"stat-card",onClick:t[10]||(t[10]=a=>b.handleStatClick("today_weight"))},{default:i((()=>[n(h,{class:"stat-icon-box blue"},{default:i((()=>[n(m,{class:"stat-icon"},{default:i((()=>[u("气")])),_:1})])),_:1}),n(h,{class:"stat-body"},{default:i((()=>[n(m,{class:"stat-label"},{default:i((()=>[u("今日出气量")])),_:1}),n(h,{class:"stat-value-row"},{default:i((()=>[n(m,{class:"stat-value"},{default:i((()=>[u(r(b.formatNumber(l.stats.today_weight,0)),1)])),_:1}),n(m,{class:"stat-unit"},{default:i((()=>[u("kg")])),_:1})])),_:1}),n(m,{class:"stat-tip"},{default:i((()=>[u("含所有客户的出瓶净重")])),_:1})])),_:1})])),_:1}),n(h,{class:"stat-card",onClick:t[11]||(t[11]=a=>b.handleStatClick("today_amount"))},{default:i((()=>[n(h,{class:"stat-icon-box green"},{default:i((()=>[n(m,{class:"stat-icon"},{default:i((()=>[u("￥")])),_:1})])),_:1}),n(h,{class:"stat-body"},{default:i((()=>[n(m,{class:"stat-label"},{default:i((()=>[u("今日销售额")])),_:1}),n(h,{class:"stat-value-row"},{default:i((()=>[n(m,{class:"stat-value"},{default:i((()=>[u(r(b.formatNumber(l.stats.today_amount,2)),1)])),_:1}),n(m,{class:"stat-unit"},{default:i((()=>[u("元")])),_:1})])),_:1}),n(m,{class:"stat-tip"},{default:i((()=>[u("按实收金额汇总")])),_:1})])),_:1})])),_:1}),n(h,{class:"stat-card",onClick:t[12]||(t[12]=a=>b.handleStatClick("month_amount"))},{default:i((()=>[n(h,{class:"stat-icon-box purple"},{default:i((()=>[n(m,{class:"stat-icon"},{default:i((()=>[u("月")])),_:1})])),_:1}),n(h,{class:"stat-body"},{default:i((()=>[n(m,{class:"stat-label"},{default:i((()=>[u("本月累计销售")])),_:1}),n(h,{class:"stat-value-row"},{default:i((()=>[n(m,{class:"stat-value"},{default:i((()=>[u(r(b.formatNumber(l.stats.month_amount,2)),1)])),_:1}),n(m,{class:"stat-unit"},{default:i((()=>[u("元")])),_:1})])),_:1}),n(m,{class:"stat-tip"},{default:i((()=>[u("本月截至目前总销售额")])),_:1})])),_:1})])),_:1}),n(h,{class:"stat-card",onClick:t[13]||(t[13]=a=>b.handleStatClick("month_unpaid"))},{default:i((()=>[n(h,{class:"stat-icon-box orange"},{default:i((()=>[n(m,{class:"stat-icon"},{default:i((()=>[u("账")])),_:1})])),_:1}),n(h,{class:"stat-body"},{default:i((()=>[n(m,{class:"stat-label"},{default:i((()=>[u("本月未收款")])),_:1}),n(h,{class:"stat-value-row"},{default:i((()=>[n(m,{class:"stat-value"},{default:i((()=>[u(r(b.formatNumber(l.stats.month_unpaid,2)),1)])),_:1}),n(m,{class:"stat-unit"},{default:i((()=>[u("元")])),_:1})])),_:1}),n(m,{class:"stat-tip"},{default:i((()=>[u("挂账客户待收金额")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),n(h,{class:"card card-actions"},{default:i((()=>[n(h,{class:"card-header"},{default:i((()=>[n(h,{class:"card-title"},{default:i((()=>[u("常用操作")])),_:1}),n(h,{class:"card-sub"},{default:i((()=>[u("高频入口，提升日常记录效率")])),_:1})])),_:1}),n(h,{class:"actions-grid"},{default:i((()=>[b.isAdmin?(o(),c(h,{key:0,class:"action-item",onClick:t[14]||(t[14]=a=>b.goPage("/pages/sale/edit","sale"))},{default:i((()=>[n(h,{class:"action-text"},{default:i((()=>[n(h,{class:"action-title-row"},{default:i((()=>[n(h,{class:"action-icon action-icon-record"},{default:i((()=>[n(m,{class:"action-icon-text"},{default:i((()=>[u("记")])),_:1})])),_:1}),n(m,{class:"action-title"},{default:i((()=>[u("新增销售记录")])),_:1})])),_:1}),n(m,{class:"action-sub"},{default:i((()=>[u("记录出瓶、回瓶、净重与应收款")])),_:1})])),_:1})])),_:1})):_("",!0),n(h,{class:"action-item",onClick:t[15]||(t[15]=a=>b.goPage("/pages/customer/list","customer"))},{default:i((()=>[n(h,{class:"action-text"},{default:i((()=>[n(h,{class:"action-title-row"},{default:i((()=>[n(h,{class:"action-icon action-icon-customer"},{default:i((()=>[n(m,{class:"action-icon-text"},{default:i((()=>[u("客")])),_:1})])),_:1}),n(m,{class:"action-title"},{default:i((()=>[u("客户管理")])),_:1})])),_:1}),n(m,{class:"action-sub"},{default:i((()=>[u("维护客户资料、地址与价格策略")])),_:1})])),_:1})])),_:1}),n(h,{class:"action-item",onClick:t[16]||(t[16]=a=>b.goPage("/pages/vehicle/list","vehicle"))},{default:i((()=>[n(h,{class:"action-text"},{default:i((()=>[n(h,{class:"action-title-row"},{default:i((()=>[n(h,{class:"action-icon action-icon-vehicle"},{default:i((()=>[n(m,{class:"action-icon-text"},{default:i((()=>[u("车")])),_:1})])),_:1}),n(m,{class:"action-title"},{default:i((()=>[u("车辆管理")])),_:1})])),_:1}),n(m,{class:"action-sub"},{default:i((()=>[u("管理送气车辆、车牌与状态")])),_:1})])),_:1})])),_:1}),n(h,{class:"action-item",onClick:t[17]||(t[17]=a=>b.goPage("/pages/delivery/list","delivery"))},{default:i((()=>[n(h,{class:"action-text"},{default:i((()=>[n(h,{class:"action-title-row"},{default:i((()=>[n(h,{class:"action-icon action-icon-delivery"},{default:i((()=>[n(m,{class:"action-icon-text"},{default:i((()=>[u("配")])),_:1})])),_:1}),n(m,{class:"action-title"},{default:i((()=>[u("配送员管理")])),_:1})])),_:1}),n(m,{class:"action-sub"},{default:i((()=>[u(" 维护配送员信息、联系方式与状态 ")])),_:1})])),_:1})])),_:1}),n(h,{class:"action-item",onClick:t[18]||(t[18]=a=>b.goPage("/pages/filling/index","filling"))},{default:i((()=>[n(h,{class:"action-text"},{default:i((()=>[n(h,{class:"action-title-row"},{default:i((()=>[n(h,{class:"action-icon action-icon-record"},{default:i((()=>[n(m,{class:"action-icon-text"},{default:i((()=>[u("灌")])),_:1})])),_:1}),n(m,{class:"action-title"},{default:i((()=>[u("灌装管理")])),_:1})])),_:1}),n(m,{class:"action-sub"},{default:i((()=>[u("记录罐车灌装、亏损与入库数据")])),_:1})])),_:1})])),_:1}),n(h,{class:"action-item",onClick:t[19]||(t[19]=a=>b.goPage("/pages/gas/inbound","gas-in"))},{default:i((()=>[n(h,{class:"action-text"},{default:i((()=>[n(h,{class:"action-title-row"},{default:i((()=>[n(h,{class:"action-icon action-icon-record"},{default:i((()=>[n(m,{class:"action-icon-text"},{default:i((()=>[u("气")])),_:1})])),_:1}),n(m,{class:"action-title"},{default:i((()=>[u("天然气入库")])),_:1})])),_:1}),n(m,{class:"action-sub"},{default:i((()=>[u("维护每车 LNG 入库净重与金额")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-f38ee4ac"]]);export{v as default};
