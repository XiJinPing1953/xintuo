import{k as a,l as t,t as s,m as e,r as l,s as c,n as i,c as d,w as o,i as n,o as u,d as r,e as f,f as _,p as g,q as b,g as m}from"./index-B6DdPhlT.js";import{_ as h,i as p,b as v,e as x,g as k,c as y,d as C}from"./_plugin-vue_export-helper.Dda_PF8M.js";const w=h({data:()=>({userInfo:{},activeMenu:"dashboard",stats:{today_weight:0,today_amount:0,month_amount:0,month_unpaid:0,gas_stock:0}}),computed:{isAdmin(){return p(this.userInfo)},isSuperAdmin(){return v(this.userInfo)}},onLoad(){x()&&(this.userInfo=k()||{},this.activeMenu="dashboard",this.fetchStats())},onShow(){x()&&this.fetchStats()},methods:{async fetchStats(){const c=a("crm_token")||a("token")||"";if(c)try{const a=(await s.callFunction({name:"crm-dashboard",data:{action:"summary",token:c}})).result||{};if(401===a.code)return void t({title:"提示",content:a.msg||"登录已过期，请重新登录",showCancel:!1,success:()=>{y(),C(),e(),l({url:"/pages/login/login"})}});0===a.code&&a.data?this.stats=Object.assign({},this.stats,a.data):console.warn("fetchStats error:",a.msg)}catch(i){console.error("fetchStats exception:",i)}else t({title:"提示",content:"登录状态已失效，请重新登录",showCancel:!1,success:()=>{y(),C()}})},formatNumber(a,t=2){const s=Number(a);return Number.isNaN(s)?0:s.toFixed(t)},formatKgToTon(a,t=3){const s=Number(a);return Number.isNaN(s)?0:(s/1e3).toFixed(t)},formatDate(a){const t=a instanceof Date?a:new Date(a);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},getTodayRange(){const a=new Date,t=this.formatDate(a);return{start:t,end:t}},getMonthRange(){const a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1);return{start:this.formatDate(t),end:this.formatDate(a),month:`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`}},goPage(a,t){t&&(this.activeMenu=t),a&&"/pages/dashboard/index"!==a&&(!a.startsWith("/pages/sale/edit")||this.isAdmin?i({url:a}):c({title:"当前账号无权限新增销售记录",icon:"none"}))},handleLogout(){t({title:"退出登录",content:"确定要退出当前账号吗？",success:a=>{a.confirm&&(y(),C())}})},handleStatClick(a){switch(a){case"gas_stock":{const{start:a,end:t}=this.getMonthRange();this.goPage(`/pages/gas/inbound?date_from=${a}&date_to=${t}`,"gas-in");break}case"today_weight":{const{start:a,end:t}=this.getTodayRange();this.goPage(`/pages/sale/list?date_from=${a}&date_to=${t}`,"sale-list");break}case"today_amount":{const{start:a,end:t}=this.getTodayRange();this.goPage(`/pages/sale/list?date_from=${a}&date_to=${t}`,"sale-list");break}case"month_amount":case"month_unpaid":{const{start:a,end:t,month:s}=this.getMonthRange();this.goPage(`/pages/bill/monthly?month=${s}&date_from=${a}&date_to=${t}`,"bill");break}}}}},[["render",function(a,t,s,e,l,c){const i=m,h=n;return u(),d(h,{class:"dashboard-page"},{default:o((()=>[r(h,{class:"dashboard-inner"},{default:o((()=>[r(h,{class:"top-hero"},{default:o((()=>[r(h,{class:"hero-left"},{default:o((()=>[r(h,{class:"hero-logo"},{default:o((()=>[r(i,{class:"hero-logo-icon"},{default:o((()=>[f("logo")])),_:1})])),_:1}),r(h,{class:"hero-text"},{default:o((()=>[r(h,{class:"hero-title"},{default:o((()=>[f("新拓能源")])),_:1})])),_:1})])),_:1}),r(h,{class:"hero-right"},{default:o((()=>[r(h,{class:"hero-user-tag"},{default:o((()=>[r(h,{class:"hero-avatar"},{default:o((()=>[r(i,{class:"hero-avatar-text"},{default:o((()=>[f(_((l.userInfo.username||"admin").slice(0,1).toUpperCase()),1)])),_:1})])),_:1}),r(h,{class:"hero-user-text"},{default:o((()=>[r(i,{class:"hero-user-role"},{default:o((()=>[f(_(c.isSuperAdmin?"超级管理员":c.isAdmin?"管理员":"普通员工"),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),r(h,{class:"layout-main"},{default:o((()=>[r(h,{class:"sidebar"},{default:o((()=>[r(h,{class:"sidebar-section"},{default:o((()=>[r(h,{class:"sidebar-section-title"},{default:o((()=>[f("日常操作")])),_:1}),c.isAdmin?(u(),d(h,{key:0,class:g(["sidebar-item",{active:"sale"===l.activeMenu}]),onClick:t[0]||(t[0]=a=>c.goPage("/pages/sale/edit","sale"))},{default:o((()=>[r(h,{class:"sidebar-badge sidebar-badge-primary"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("记")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("新增销售记录")])),_:1})])),_:1},8,["class"])):b("",!0),r(h,{class:g(["sidebar-item",{active:"sale-list"===l.activeMenu}]),onClick:t[1]||(t[1]=a=>c.goPage("/pages/sale/list","sale-list"))},{default:o((()=>[r(h,{class:"sidebar-badge"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("销")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("销售记录列表")])),_:1})])),_:1},8,["class"]),r(h,{class:g(["sidebar-item",{active:"bill"===l.activeMenu}]),onClick:t[2]||(t[2]=a=>c.goPage("/pages/bill/monthly","bill"))},{default:o((()=>[r(h,{class:"sidebar-badge"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("账")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("对账单")])),_:1})])),_:1},8,["class"]),r(h,{class:g(["sidebar-item",{active:"filling"===l.activeMenu}]),onClick:t[3]||(t[3]=a=>c.goPage("/pages/filling/index","filling"))},{default:o((()=>[r(h,{class:"sidebar-badge sidebar-badge-accent"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("灌")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("灌装管理")])),_:1})])),_:1},8,["class"]),r(h,{class:g(["sidebar-item",{active:"gas-in"===l.activeMenu}]),onClick:t[4]||(t[4]=a=>c.goPage("/pages/gas/inbound","gas-in"))},{default:o((()=>[r(h,{class:"sidebar-badge"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("气")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("天然气入库")])),_:1})])),_:1},8,["class"])])),_:1}),r(h,{class:"sidebar-section"},{default:o((()=>[r(h,{class:"sidebar-section-title"},{default:o((()=>[f("基础资料")])),_:1}),r(h,{class:g(["sidebar-item",{active:"customer"===l.activeMenu}]),onClick:t[5]||(t[5]=a=>c.goPage("/pages/customer/list","customer"))},{default:o((()=>[r(h,{class:"sidebar-badge"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("客")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("客户管理")])),_:1})])),_:1},8,["class"]),r(h,{class:g(["sidebar-item",{active:"vehicle"===l.activeMenu}]),onClick:t[6]||(t[6]=a=>c.goPage("/pages/vehicle/list","vehicle"))},{default:o((()=>[r(h,{class:"sidebar-badge"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("车")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("车辆管理")])),_:1})])),_:1},8,["class"]),r(h,{class:g(["sidebar-item",{active:"delivery"===l.activeMenu}]),onClick:t[7]||(t[7]=a=>c.goPage("/pages/delivery/list","delivery"))},{default:o((()=>[r(h,{class:"sidebar-badge"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("配")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("配送员管理")])),_:1})])),_:1},8,["class"]),c.isSuperAdmin?(u(),d(h,{key:0,class:g(["sidebar-item",{active:"roles"===l.activeMenu}]),onClick:t[8]||(t[8]=a=>c.goPage("/pages/admin/roles","roles"))},{default:o((()=>[r(h,{class:"sidebar-badge sidebar-badge-primary"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("权")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("角色与权限")])),_:1})])),_:1},8,["class"])):b("",!0),c.isSuperAdmin?(u(),d(h,{key:1,class:g(["sidebar-item",{active:"logs"===l.activeMenu}]),onClick:t[9]||(t[9]=a=>c.goPage("/pages/admin/logs","logs"))},{default:o((()=>[r(h,{class:"sidebar-badge sidebar-badge-primary"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("记")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("操作日志")])),_:1})])),_:1},8,["class"])):b("",!0),r(h,{class:g(["sidebar-item",{active:"bottle"===l.activeMenu}]),onClick:t[10]||(t[10]=a=>c.goPage("/pages/bottle/manage","bottle"))},{default:o((()=>[r(h,{class:"sidebar-badge"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("瓶")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("瓶子管理")])),_:1})])),_:1},8,["class"])])),_:1}),r(h,{class:"sidebar-footer"},{default:o((()=>[r(h,{class:"sidebar-divider"}),r(h,{class:"sidebar-item danger",onClick:c.handleLogout},{default:o((()=>[r(h,{class:"sidebar-badge sidebar-badge-danger"},{default:o((()=>[r(i,{class:"sidebar-badge-text"},{default:o((()=>[f("退")])),_:1})])),_:1}),r(i,{class:"sidebar-text"},{default:o((()=>[f("退出登录")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),r(h,{class:"main-content"},{default:o((()=>[r(h,{class:"card card-stats"},{default:o((()=>[r(h,{class:"card-header"},{default:o((()=>[r(h,{class:"card-title"},{default:o((()=>[f("今日概览")])),_:1}),r(h,{class:"card-sub"},{default:o((()=>[f("出气量、销售额、未收款与天然气库存")])),_:1})])),_:1}),r(h,{class:"stats-row"},{default:o((()=>[r(h,{class:"stat-card",onClick:t[11]||(t[11]=a=>c.handleStatClick("gas_stock"))},{default:o((()=>[r(h,{class:"stat-icon-box blue"},{default:o((()=>[r(i,{class:"stat-icon"},{default:o((()=>[f("存")])),_:1})])),_:1}),r(h,{class:"stat-body"},{default:o((()=>[r(i,{class:"stat-label"},{default:o((()=>[f("当前天然气库存")])),_:1}),r(h,{class:"stat-value-row"},{default:o((()=>[r(i,{class:"stat-value"},{default:o((()=>[f(_(c.formatKgToTon(l.stats.gas_stock)),1)])),_:1}),r(i,{class:"stat-unit"},{default:o((()=>[f("吨")])),_:1})])),_:1}),r(i,{class:"stat-tip"},{default:o((()=>[f("按入库净重减去销售净重自动估算")])),_:1})])),_:1})])),_:1}),r(h,{class:"stat-card",onClick:t[12]||(t[12]=a=>c.handleStatClick("today_weight"))},{default:o((()=>[r(h,{class:"stat-icon-box blue"},{default:o((()=>[r(i,{class:"stat-icon"},{default:o((()=>[f("气")])),_:1})])),_:1}),r(h,{class:"stat-body"},{default:o((()=>[r(i,{class:"stat-label"},{default:o((()=>[f("今日出气量")])),_:1}),r(h,{class:"stat-value-row"},{default:o((()=>[r(i,{class:"stat-value"},{default:o((()=>[f(_(c.formatNumber(l.stats.today_weight,0)),1)])),_:1}),r(i,{class:"stat-unit"},{default:o((()=>[f("kg")])),_:1})])),_:1}),r(i,{class:"stat-tip"},{default:o((()=>[f("含所有客户的出瓶净重")])),_:1})])),_:1})])),_:1}),r(h,{class:"stat-card",onClick:t[13]||(t[13]=a=>c.handleStatClick("today_amount"))},{default:o((()=>[r(h,{class:"stat-icon-box green"},{default:o((()=>[r(i,{class:"stat-icon"},{default:o((()=>[f("￥")])),_:1})])),_:1}),r(h,{class:"stat-body"},{default:o((()=>[r(i,{class:"stat-label"},{default:o((()=>[f("今日销售额")])),_:1}),r(h,{class:"stat-value-row"},{default:o((()=>[r(i,{class:"stat-value"},{default:o((()=>[f(_(c.formatNumber(l.stats.today_amount,2)),1)])),_:1}),r(i,{class:"stat-unit"},{default:o((()=>[f("元")])),_:1})])),_:1}),r(i,{class:"stat-tip"},{default:o((()=>[f("按实收金额汇总")])),_:1})])),_:1})])),_:1}),r(h,{class:"stat-card",onClick:t[14]||(t[14]=a=>c.handleStatClick("month_amount"))},{default:o((()=>[r(h,{class:"stat-icon-box purple"},{default:o((()=>[r(i,{class:"stat-icon"},{default:o((()=>[f("月")])),_:1})])),_:1}),r(h,{class:"stat-body"},{default:o((()=>[r(i,{class:"stat-label"},{default:o((()=>[f("本月累计销售")])),_:1}),r(h,{class:"stat-value-row"},{default:o((()=>[r(i,{class:"stat-value"},{default:o((()=>[f(_(c.formatNumber(l.stats.month_amount,2)),1)])),_:1}),r(i,{class:"stat-unit"},{default:o((()=>[f("元")])),_:1})])),_:1}),r(i,{class:"stat-tip"},{default:o((()=>[f("本月截至目前总销售额")])),_:1})])),_:1})])),_:1}),r(h,{class:"stat-card",onClick:t[15]||(t[15]=a=>c.handleStatClick("month_unpaid"))},{default:o((()=>[r(h,{class:"stat-icon-box orange"},{default:o((()=>[r(i,{class:"stat-icon"},{default:o((()=>[f("账")])),_:1})])),_:1}),r(h,{class:"stat-body"},{default:o((()=>[r(i,{class:"stat-label"},{default:o((()=>[f("本月未收款")])),_:1}),r(h,{class:"stat-value-row"},{default:o((()=>[r(i,{class:"stat-value"},{default:o((()=>[f(_(c.formatNumber(l.stats.month_unpaid,2)),1)])),_:1}),r(i,{class:"stat-unit"},{default:o((()=>[f("元")])),_:1})])),_:1}),r(i,{class:"stat-tip"},{default:o((()=>[f("挂账客户待收金额")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),r(h,{class:"card card-actions"},{default:o((()=>[r(h,{class:"card-header"},{default:o((()=>[r(h,{class:"card-title"},{default:o((()=>[f("常用操作")])),_:1}),r(h,{class:"card-sub"},{default:o((()=>[f("高频入口，提升日常记录效率")])),_:1})])),_:1}),r(h,{class:"actions-grid"},{default:o((()=>[c.isAdmin?(u(),d(h,{key:0,class:"action-item",onClick:t[16]||(t[16]=a=>c.goPage("/pages/sale/edit","sale"))},{default:o((()=>[r(h,{class:"action-text"},{default:o((()=>[r(h,{class:"action-title-row"},{default:o((()=>[r(h,{class:"action-icon action-icon-record"},{default:o((()=>[r(i,{class:"action-icon-text"},{default:o((()=>[f("记")])),_:1})])),_:1}),r(i,{class:"action-title"},{default:o((()=>[f("新增销售记录")])),_:1})])),_:1}),r(i,{class:"action-sub"},{default:o((()=>[f("记录出瓶、回瓶、净重与应收款")])),_:1})])),_:1})])),_:1})):b("",!0),r(h,{class:"action-item",onClick:t[17]||(t[17]=a=>c.goPage("/pages/customer/list","customer"))},{default:o((()=>[r(h,{class:"action-text"},{default:o((()=>[r(h,{class:"action-title-row"},{default:o((()=>[r(h,{class:"action-icon action-icon-customer"},{default:o((()=>[r(i,{class:"action-icon-text"},{default:o((()=>[f("客")])),_:1})])),_:1}),r(i,{class:"action-title"},{default:o((()=>[f("客户管理")])),_:1})])),_:1}),r(i,{class:"action-sub"},{default:o((()=>[f("维护客户资料、地址与价格策略")])),_:1})])),_:1})])),_:1}),r(h,{class:"action-item",onClick:t[18]||(t[18]=a=>c.goPage("/pages/vehicle/list","vehicle"))},{default:o((()=>[r(h,{class:"action-text"},{default:o((()=>[r(h,{class:"action-title-row"},{default:o((()=>[r(h,{class:"action-icon action-icon-vehicle"},{default:o((()=>[r(i,{class:"action-icon-text"},{default:o((()=>[f("车")])),_:1})])),_:1}),r(i,{class:"action-title"},{default:o((()=>[f("车辆管理")])),_:1})])),_:1}),r(i,{class:"action-sub"},{default:o((()=>[f("管理送气车辆、车牌与状态")])),_:1})])),_:1})])),_:1}),r(h,{class:"action-item",onClick:t[19]||(t[19]=a=>c.goPage("/pages/delivery/list","delivery"))},{default:o((()=>[r(h,{class:"action-text"},{default:o((()=>[r(h,{class:"action-title-row"},{default:o((()=>[r(h,{class:"action-icon action-icon-delivery"},{default:o((()=>[r(i,{class:"action-icon-text"},{default:o((()=>[f("配")])),_:1})])),_:1}),r(i,{class:"action-title"},{default:o((()=>[f("配送员管理")])),_:1})])),_:1}),r(i,{class:"action-sub"},{default:o((()=>[f(" 维护配送员信息、联系方式与状态 ")])),_:1})])),_:1})])),_:1}),r(h,{class:"action-item",onClick:t[20]||(t[20]=a=>c.goPage("/pages/filling/index","filling"))},{default:o((()=>[r(h,{class:"action-text"},{default:o((()=>[r(h,{class:"action-title-row"},{default:o((()=>[r(h,{class:"action-icon action-icon-record"},{default:o((()=>[r(i,{class:"action-icon-text"},{default:o((()=>[f("灌")])),_:1})])),_:1}),r(i,{class:"action-title"},{default:o((()=>[f("灌装管理")])),_:1})])),_:1}),r(i,{class:"action-sub"},{default:o((()=>[f("记录罐车灌装、亏损与入库数据")])),_:1})])),_:1})])),_:1}),r(h,{class:"action-item",onClick:t[21]||(t[21]=a=>c.goPage("/pages/gas/inbound","gas-in"))},{default:o((()=>[r(h,{class:"action-text"},{default:o((()=>[r(h,{class:"action-title-row"},{default:o((()=>[r(h,{class:"action-icon action-icon-record"},{default:o((()=>[r(i,{class:"action-icon-text"},{default:o((()=>[f("气")])),_:1})])),_:1}),r(i,{class:"action-title"},{default:o((()=>[f("天然气入库")])),_:1})])),_:1}),r(i,{class:"action-sub"},{default:o((()=>[f("维护每车 LNG 入库净重与金额")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-55636080"]]);export{w as default};
