import{s as t,a as e,t as a,h as s,C as l,u as i,r as o,v as n,c as r,w as d,i as u,o as c,d as m,e as f,f as h,g as p,I as g,z as b,D as _,j as v}from"./index-B6DdPhlT.js";import{B as k}from"./BackToDashboardBar.0jhbkRhX.js";import{_ as y,e as x,f as I}from"./_plugin-vue_export-helper.Dda_PF8M.js";const B=y({components:{BackToDashboardBar:k},data:()=>({id:"",submitting:!1,form:{name:"",mobile:"",status:"active",remark:""},statusOptions:[{label:"在职",value:"active"},{label:"请假/停工",value:"on_leave"},{label:"离职",value:"inactive"}],statusIndex:0}),computed:{isEdit(){return!!this.id},statusLabel(){return this.statusOptions[this.statusIndex].label}},onLoad(t){x()&&(this.id=(null==t?void 0:t.id)||"",this.id&&this.loadDetail())},methods:{getToken(){const e=I();return e||(t({title:"登录已过期，请重新登录",icon:"none"}),x(),"")},onStatusChange(t){const e=Number(t.detail.value||0);this.statusIndex=e,this.form.status=this.statusOptions[e].value},onMobileInput(t){let e=(t.detail.value||"").replace(/[^\d-]/g,"");e=e.replace(/-+/g,"-").slice(0,20),this.form.mobile=e},normalizeMobile(){const t=(this.form.mobile||"").trim();if(!t)return"";const e=t.replace(/\s+/g,""),a=e.replace(/\D/g,""),s=/^1[3-9]\d{9}$/.test(a),l=e.match(/^(\d{3,4})-?(\d{5,8})$/);return s?a:l?`${l[1]}-${l[2]}`:null},async loadDetail(){const l=this.getToken();if(l)try{e({title:"加载中…",mask:!0});const i=(await a.callFunction({name:"crm-delivery",data:{action:"get",token:l,data:{id:this.id}}})).result||{};if(401===i.code)return t({title:i.msg||"登录已过期，请重新登录",icon:"none"}),void x();if(0!==i.code||!i.data)return void t({title:i.msg||"加载失败",icon:"none"});const o=i.data;this.form.name=o.name||"",this.form.mobile=o.mobile||o.phone||"",this.form.status=o.status||"active",this.form.remark=o.remark||"";const n=this.statusOptions.findIndex((t=>t.value===this.form.status));this.statusIndex=n>=0?n:0}catch(i){console.error("load delivery detail error:",i),t({title:"加载失败，请稍后再试",icon:"none"})}finally{s()}},async handleSubmit(){if(this.submitting)return;const l=(this.form.name||"").trim();if(!l)return t({title:"请填写姓名",icon:"none"});const i=this.normalizeMobile();if(null===i)return t({title:"手机号格式不正确，请检查",icon:"none"});const o=this.getToken();if(!o)return;const n={name:l,mobile:i,status:this.form.status,remark:this.form.remark.trim()};this.submitting=!0;try{e({title:this.isEdit?"保存中…":"创建中…",mask:!0});const l=(await a.callFunction({name:"crm-delivery",data:{action:this.isEdit?"update":"create",token:o,data:this.isEdit?{id:this.id,...n}:n}})).result||{};if(401===l.code)return t({title:l.msg||"登录已过期，请重新登录",icon:"none"}),void x();if(0!==l.code)return void t({title:l.msg||"保存失败",icon:"none"});t({title:this.isEdit?"保存成功":"创建成功",icon:"success"}),setTimeout((()=>{this.goBack()}),300)}catch(r){console.error("save delivery error:",r),t({title:"保存失败，请稍后再试",icon:"none"})}finally{this.submitting=!1,s()}},goBack(){l().length>1?i():o({url:"/pages/delivery/list"})}}},[["render",function(t,e,a,s,l,i){const o=n("BackToDashboardBar"),k=p,y=u,x=g,I=b,B=_,w=v;return c(),r(y,{class:"page"},{default:d((()=>[m(y,{class:"inner"},{default:d((()=>[m(o,{"back-to":"/pages/delivery/list",text:"返回"}),m(y,{class:"page-header"},{default:d((()=>[m(y,{class:"page-header-left"},{default:d((()=>[m(y,{class:"page-icon"},{default:d((()=>[m(k,{class:"page-icon-text"},{default:d((()=>[f("配")])),_:1})])),_:1}),m(y,{class:"page-header-text"},{default:d((()=>[m(k,{class:"page-title"},{default:d((()=>[f(h(i.isEdit?"编辑配送员":"新增配送员"),1)])),_:1}),m(k,{class:"page-sub"},{default:d((()=>[f(" 维护配送员姓名、联系方式与状态信息 ")])),_:1})])),_:1})])),_:1})])),_:1}),m(y,{class:"card"},{default:d((()=>[m(y,{class:"card-header"},{default:d((()=>[m(k,{class:"card-title"},{default:d((()=>[f("基本信息")])),_:1})])),_:1}),m(y,{class:"card-body"},{default:d((()=>[m(y,{class:"form-item"},{default:d((()=>[m(k,{class:"label"},{default:d((()=>[f("* 姓名")])),_:1}),m(y,{class:"input-wrapper"},{default:d((()=>[m(x,{class:"input",modelValue:l.form.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.form.name=t),placeholder:"请输入配送员姓名"},null,8,["modelValue"])])),_:1})])),_:1}),m(y,{class:"form-item"},{default:d((()=>[m(k,{class:"label"},{default:d((()=>[f("手机号")])),_:1}),m(y,{class:"input-wrapper"},{default:d((()=>[m(x,{class:"input",value:l.form.mobile,type:"text",maxlength:"20",placeholder:"可填写手机号或联系电话",onInput:i.onMobileInput},null,8,["value","onInput"])])),_:1})])),_:1}),m(y,{class:"form-item"},{default:d((()=>[m(k,{class:"label"},{default:d((()=>[f("状态")])),_:1}),m(I,{mode:"selector",range:l.statusOptions,"range-key":"label",value:l.statusIndex,onChange:i.onStatusChange},{default:d((()=>[m(y,{class:"input-wrapper"},{default:d((()=>[m(y,{class:"picker"},{default:d((()=>[m(k,null,{default:d((()=>[f(h(i.statusLabel),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["range","value","onChange"])])),_:1}),m(y,{class:"form-item"},{default:d((()=>[m(k,{class:"label"},{default:d((()=>[f("备注")])),_:1}),m(B,{class:"textarea",modelValue:l.form.remark,"onUpdate:modelValue":e[1]||(e[1]=t=>l.form.remark=t),placeholder:"例如：主负责城北片区、熟悉XX路段"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(y,{class:"btn-row-bottom"},{default:d((()=>[m(w,{class:"btn-primary",loading:l.submitting,onClick:i.handleSubmit},{default:d((()=>[f(h(i.isEdit?"保存修改":"保存配送员"),1)])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-b0db6af1"]]);export{B as default};
