import{s as a,u as t,v as e,c as s,w as l,i as o,o as r,d as i,e as d,f as n,x as c,y as g,F as u,q as f,g as h,j as p}from"./index-B6DdPhlT.js";import{B as _}from"./BackToDashboardBar.0jhbkRhX.js";import{_ as m,e as y,g as S,b}from"./_plugin-vue_export-helper.Dda_PF8M.js";import{c as k}from"./request.DMeHGM82.js";const D=m({components:{BackToDashboardBar:_},data:()=>({logs:[],page:1,pageSize:30,total:0,loading:!1}),computed:{hasMore(){return this.logs.length<this.total}},onLoad(){if(!y())return;const e=S()||{};if(!b(e))return a({title:"仅超级管理员可访问",icon:"none"}),void t();this.loadLogs(!0)},methods:{roleLabel:a=>"superadmin"===a?"超级管理员":"admin"===a?"管理员":"user"===a?"普通员工":a||"未设置",formatDateTime(a){if(!a)return"-";const t=new Date(a);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},formatDetail(a){if(!a)return"—";if("string"==typeof a)return a;try{return JSON.stringify(a)}catch(t){return"—"}},async loadLogs(a=!1){if(this.loading)return;this.loading=!0;const t=a?1:this.page,e=await k("crm-logs",{action:"list",data:{page:t,pageSize:this.pageSize}});if(this.loading=!1,0!==e.code)return;this.total=e.total||0,this.page=t;const s=Array.isArray(e.data)?e.data:[];this.logs=a?s:this.logs.concat(s)},loadMore(){!this.loading&&this.hasMore&&(this.page+=1,this.loadLogs())}}},[["render",function(a,t,_,m,y,S){const b=e("BackToDashboardBar"),k=h,D=o,B=p;return r(),s(D,{class:"logs-page"},{default:l((()=>[i(b,{"back-to":"/pages/dashboard/index",text:"返回工作台"}),i(D,{class:"card"},{default:l((()=>[i(D,{class:"card-header"},{default:l((()=>[i(k,{class:"card-title"},{default:l((()=>[d("操作日志")])),_:1}),i(k,{class:"card-sub"},{default:l((()=>[d("仅超级管理员可见，按时间倒序展示所有用户动作")])),_:1})])),_:1}),i(D,{class:"filters"},{default:l((()=>[i(D,{class:"filter-chip"},{default:l((()=>[d("共 "+n(y.total)+" 条",1)])),_:1})])),_:1}),i(D,{class:"card-body"},{default:l((()=>[y.loading&&0===y.logs.length?(r(),s(D,{key:0,class:"empty"},{default:l((()=>[i(k,null,{default:l((()=>[d("加载中…")])),_:1})])),_:1})):0===y.logs.length?(r(),s(D,{key:1,class:"empty"},{default:l((()=>[i(k,null,{default:l((()=>[d("暂无日志")])),_:1})])),_:1})):(r(),s(D,{key:2,class:"log-list"},{default:l((()=>[(r(!0),c(u,null,g(y.logs,(a=>(r(),s(D,{key:a._id,class:"log-item"},{default:l((()=>[i(D,{class:"log-meta"},{default:l((()=>[i(k,{class:"user"},{default:l((()=>[d(n(a.username||"未知用户")+"（"+n(S.roleLabel(a.role))+"）",1)])),_:2},1024),i(k,{class:"time"},{default:l((()=>[d(n(S.formatDateTime(a.created_at)),1)])),_:2},1024)])),_:2},1024),i(D,{class:"log-content"},{default:l((()=>[i(k,{class:"action"},{default:l((()=>[d(n(a.action||"-"),1)])),_:2},1024),i(k,{class:"detail"},{default:l((()=>[d(n(S.formatDetail(a.detail)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1}),S.hasMore?(r(),s(D,{key:0,class:"footer"},{default:l((()=>[i(B,{class:"load-more",loading:y.loading,onClick:S.loadMore},{default:l((()=>[d("加载更多")])),_:1},8,["loading","onClick"])])),_:1})):f("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-2eba830c"]]);export{D as default};
